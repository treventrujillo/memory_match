(function(){App.ns("Controls.CodeSnippets.CreateController",App.Control({init:function(e,t){}}))}).call(this),function(){App.ns("Controls.CodeSnippets.EditController",App.Controls.Ide({init:function(e,t){return this.fields=App.data.fields.code_snippet,App.data.activeCode="code",App.data.activeFixture="fixture",$("#translation_details dd a:first").click(),new App.Controls.CodeSnippetListItemController(this.element),this.track("loaded")},ready:function(){return $.wait(function(e){return function(){return e.renderViews()}}(this))},filters:{"tdd_language?":function(){return this.isTddLanguage()},"tdd_enabled?":function(){return this.isTddEnabled()},"active_language_supported?":function(){return this.isSupportedLanguage()},"can_save?":function(){return this.canSave()},"has_code?":function(){return this.hasCode()},"can_run?":function(){return this.canRun()},language_versions:function(){return this.getLanguageInfo()},active_language:function(){return this.getLanguage()},active_version:function(){return this.getLanguageVersion()},active_version_label:function(){var e,t;t=this.getLanguageVersion(),e=this.getLanguageInfo();if(e)return e=e.find(function(e){return e.id===t}),(e!=null?e.label:void 0)||t}},events:{"window beforeunload":function(e,t){if(this.dirty&&!App.ignoreConfirm)return t.preventDefault(),"You have unsaved changes!"},"#editors view:render":function(){return this.configureIde(),this.configureEditors(),this.setLanguage(this.getLanguage()),this.setTestFramework()},"#edit view:render":function(){return this.configureIde()},"#languages dd click":function(e){var t;return t=$("#languages dd.is-active"),this.setLanguage(t.data("language"))},"#versions dd click":function(e){return this.setLanguageVersion(e.data("version"))},"#control_bar .profile-pic-list li:not(.is-disabled) click":function(e){return $("#control_bar .profile-pic-list li.is-active").removeClass("is-active"),e.addClass("is-active"),$(".js-tab").hide()},"#tdd_mode:not(.is-disabled) click":function(e){return App.data.tdd=!App.data.tdd,$("#options_bar, #editors").renderView(),this.track("TDD Toggled")},"#edit_btn click":function(){return $.wait(function(){return $("#edit").renderView()})},"#save_btn click":function(){return this.save()},"#publish_btn:not(.is-disabled) click":function(){return this.publish()},"#unpublish_btn click":function(){return this.unpublish()},"#convert_btn click":function(){return App.confirmModal.show({titleHtml:"Are you sure you want to convert?",messageHtml:"This will create a new kata using the data in this kumite. The kumite will be unpublished/hidden.",cancelHtml:"Cancel",confirmHtml:"Do it!",cancel:function(e){return function(){}}(this),confirm:function(e){return function(){return $("#buttons .btn").addClass("is-disabled"),e.save(function(){return $("#buttons .btn").addClass("is-disabled"),$.requestFrame(function(){return $.post(App.route("convert"),null,function(e){var t;if((t=e.data)!=null?t.url:void 0)return App.load(e.data.url)})})})}}(this)})},"texteditor.change":function(){return this.updateButtons(!0),this.dirty=!0},"#code_snippet_title change, #code_snippet_title keyup":function(){return this.updateTitle()},"#code_snippet_user_tags change, #code_snippet_user_tags keyup":function(){return this.updateTags()},"#code_snippet_secret change, #code_snippet_secret click":function(){return this.updateTitle()},"texteditor.submit":function(){if(this.hasCode())return this.validate()},"dd[data-framework] click":function(e){return $("#code_snippet_test_framework").val(e.data("framework")).change()},"#code_container dd a click":function(e){return App.data.activeCode=e.data("tab"),this.updateButtons(!0)},"#fixture_container dd a click":function(e){return App.data.activeFixture=e.data("tab")},".js-details-link click":function(){return $("#edit_btn a").click()}},canSave:function(){if(this.canRun())return App.data.isTranslation?this.fields.code.value:!!this.fields.code.value},canRun:function(){return this.hasCode()&&!this.running&&!this.publishing},isSupportedLanguage:function(e){return e==null&&(e=this.getLanguage()),App.data.supportedLanguages.indexOf(e)>=0},isTddLanguage:function(){return App.data.tddLanguages.indexOf(this.getLanguage())>=0},isTddEnabled:function(){return App.data.tdd&&this.isTddLanguage()},updateTags:function(){var e,t;if(this.tags!==this.fields.user_tags.value)return e=this.tags=this.fields.user_tags.value,(t=this.mapTags)!=null&&t.reject(),this.mapTags=$.wait(100,function(){return $.post(App.route("map_topics"),{query:e},function(e){return App.data.mappedTags=e.tags,$("#tags").render()})})},updateTitle:function(){return $("#title").renderView()},updateButtons:function(e){if(e||this.canSave()!==App.data.canSave)return App.data.canSave=this.canSave(),$("#buttons").renderView()},activeCodeEditor:function(){switch(App.data.activeCode){case"code":return this.editor;case"setup":return this.setupCode;case"package":return this["package"]}},toggleFocusedEditor:function(){return this.activeCodeEditor().focused&&this.fixture?this.fixture.focus():this.activeCodeEditor().focus()},toggleTabs:function(){var e,t;return e=$("#panel_toggles li.is-active"),t=e.next(),t.length===0&&(t=e.siblings().eq(0)),t.find("a").click()},configureEditor:function(e,t){if(e)return App.data.publishedForks&&e.setReadOnly(!0),e.options.stashGroup=App.data.id,e.setOption("commands",{save:function(e){return function(){return e.validate()}}(this)}),e.setMode(this.getLanguage(),t),e.setExtraKeys({"Cmd-S":function(e){return function(){return App.data.published?e.publish():e.save()}}(this),"Cmd-I":function(e){return function(){return e.toggleTabs()}}(this),"Cmd-U":function(e){return function(){return e.toggleFocusedEditor()}}(this)}),this.editors.push(e)},configureEditors:function(){return this.editors=[],this.code=this.editor=$("#code_snippet_code_field").data("editor"),this.editor&&($.wait(function(e){return function(){return e.configureEditor(e.editor,!0)}}(this)),this.editor.focus()),this.fixture=$("#code_snippet_fixture_field").data("editor"),this.fixture&&(this.configureEditor(this.fixture),this.fixture.emptyCodeMsg=function(){return"You are using TDD. You must provide test cases before you can run your code. You can turn TDD mode off using the switch in the upper right corner."}),this["package"]=$("#code_snippet_package_field").data("editor"),this.configureEditor(this["package"]),this.setupCode=$("#code_snippet_setup_code_field").data("editor"),this.configureEditor(this.setupCode),this.exampleFixture=$("#code_snippet_example_fixture_field").data("editor"),this.configureEditor(this.exampleFixture)},render:function(){return this.updateButtons(!0),this.updateTitle(),$("#buttons, #edit, #editors, #options_bar, #language_info").renderView()},setTestFramework:function(e){var t;e=e||this.fields.test_framework.value||$("#test_framework dd").data("framework");if(e)return t=$("dd[data-framework="+e+"]"),t.length===0&&(t=$("dd[data-framework]").eq(0)),t.click().click()},getLanguage:function(){return this.fields.language.value||App.data.language},getLanguageVersion:function(){return this.fields.language_version.value},getLanguageInfo:function(e){return e==null&&(e=this.getLanguage()),App.data.versionInfo[e]},setLanguageVersion:function(e,t){var n,r,i,s;return n=this.fields.language.value,e&&e===t?e!==n?this.setLanguageVersion(n,e):this.setLanguageVersion(null,e):App.data.versionInfo[e]?e===this.fields.language.originalValue?this.setLanguageVersion(this.fields.language_version.originalValue,e):(r=this.getLanguageInfo(e),r?this.setLanguageVersion((i=r.find(function(e){return e["default"]}))!=null?i.id:void 0,e):this.setLanguageVersion(null,e)):e||!n?this.fields.language_version.value=e:this.fields.language_version.value=(s=App.data.versionInfo[n])!=null?s[0].id:void 0},setLanguage:function(e){var t,n;if(e&&this.getLanguage()!==e||!this.languageSet)this.languageSet=!0,this.resetFixtures(),this.fields.language.value=e,this.setLanguageVersion(e),this.setTestFramework(),t=this.fields.language.value,App.data.language=t,this.render(),(n=this.editors)!=null&&n.forEach(function(e){return e.setMode(t)}),this.isSupportedLanguage()?$("#output_btn").show():$("#output_btn").hide().hasClass("is-active")&&$("#edit_btn a").click();return this.defaultFixtures()},setEditorBorder:function(e,t){},hasCode:function(){var e;return(e=this.editor)!=null?!!e.getValue():!!void 0},getCode:function(){var e,t;return App.data.activeCode==="setup"&&!this.publishing?(e=this.setupCode)!=null?e.getValue():void 0:(t=this.editor)!=null?t.getValue():void 0},fixtureEditors:function(){return[this.exampleFixture,this.fixture]},resetFixtures:function(){var e;if(this.fixture)return e=this.getLanguage(),this.fixtureEditors().each(function(t){if(t.getValue()===t.defaultFixtureText(e))return t.setValue("")})},defaultFixtures:function(){var e;if(this.fixture)return e=this.getLanguage(),this.fixtureEditors().each(function(t){if((t.getValue()||"")==="")return t.setValue(t.defaultFixtureText(e))})},getFixture:function(){if(this.fixture){if(App.data.activeFixture==="example_fixture")return this.exampleFixture.getValue();if(App.data.isTranslation||this.isTddEnabled())return this.fixture.getValue()}},getPackage:function(){return this["package"]?this["package"].getValue():this.fields["package"].value},getTestFramework:function(){return this.fields.test_framework.value||App.data.defaultFrameworks[this.getLanguage()]},validate:function(){if(this.isSupportedLanguage())return $("#output_btn").click(),this.run({language:this.getLanguage(),languageVersion:this.getLanguageVersion()+"",setup:this.getPackage(),relayId:App.data.id})},save:function(e){return App.alerts.working("Saving..."),$("#code_snippet_language").val(this.getLanguage()),$("#code_snippet_language_version").val(this.getLanguageVersion()),$("form").postForm({url:App.data["new"]?App.route("create"):App.route("update",{id:App.data.id}),type:App.data["new"]?"POST":"PUT",scrollTo:!1,success:function(t){return function(n){return t.dirty=!1,App.alerts.hide(),App.data.fields=n.fields,App.data.errors=n.errors,n.success?(n.id&&(App.data.id=n.id),App.data["new"]&&n.url?App.load(n.url):(n.url&&App.replaceHistoryState(n.url),t.updateTitle(),typeof e=="function"&&e())):(t.publishing=!1,$("#edit_btn a").click()),t.render()}}(this)})},publish:function(){return this.track("Publish"),App.alerts.working("Publishing..."),this.editor&&this.editor.messages.hide(),this.fixture&&this.fixture.messages.hide(),$(".js-run").addClass("is-disabled"),this.publishing=!0,this.save(function(e){return function(){return e.validate()}}(this))},handleResponse:function(){var e;App.debug("handleResponse()"),this.updateButtons(!0);if(this.publishing){e=this.outputPanel.runner.response;if(e!=null?!e.token:!void 0){this.running=!1,this.publishing=!1,this.updateButtons(!0),window.alert("Something went wrong, please try republishing again");return}return this.showOutputWaiting("Publishing..."),$(".js-run").removeClass("is-disabled"),this.publishing=!1,e={token:e.token,run_result:JSON.stringify({response:{result:e.result}})},$.ajax({url:App.route("publish",{id:App.data.id}),type:"post",data:e,dataType:"json",success:function(e){return function(t){return App.debug(t),$("#publish_btn").removeClass("is-disabled"),(App.data.allowFailedTests||t.completed)&&!t.message?App.load(App.route("show",{id:App.data.id})):(App.alerts.warn("Kumite was published with failed tests!"),e.editor.messages.hide(),e.showResults(t))}}(this)})}},unpublish:function(){return this.track("Unpublish"),$.post(App.route("unpublish",{id:App.data.id}),null,function(e){if(e.success)return App.load()})},track:function(e,t){return t==null&&(t={}),t.language=this.getLanguage(),t.published=App.data.published,t.record_id=App.data.id,t.isFork=!!App.data.parent,t.code_challenge_title=$("#code_snippet_title").val(),App.track("Kumite-Edit: "+e,t)}}))}.call(this),function(){App.ns("Controls.CodeSnippets.IndexController",App.Control({init:function(e,t){return new App.Controls.InfiniteScroll("section.items-list",{offsetTop:-1e3}),new App.Controls.CodeSnippetListItemController(this.element),this.track("Loaded")},events:{"#search_bar a click":function(){return this.search()},"#personal click":function(){return this.search()},".js-lang click":function(e){var t;return t=e.data("lang"),t===App.data.language?App.data.language=null:App.data.language=t,this.search()},"#search_bar input keypress":function(e,t){if(t.keyCode===13)return t.preventDefault(),this.search()}},filterUrl:function(e){var t;return t={q:e||$("#search_bar input").val(),personal:$("#personal input:checked").length===1,secrets:$("#secrets input:checked").length===1,language:App.data.language},Object.keys(t).forEach(function(e){if(!t[e]&&e!=="q")return delete t[e]}),App.route("search",null,t)},search:function(e){return e==null&&(e=$("#search_bar input").val()),this.filter(e),this.track("Search",{search:e})},filter:function(e){return App.load(this.filterUrl(e))},track:function(e,t){return t==null&&(t={}),App.track("Kumite-Index: "+e,t)}}))}.call(this),function(){App.ns("Controls.CodeSnippets.ShowController",App.Control({init:function(e,t){return this.listItem=new App.Controls.CodeSnippetListItemController(this.element),this.diffs=new App.Controls.DiffController(this.element),this.track("Inited")},ready:function(){var e,t;t=App.locationParams();if(!t.sel)return this.activateRoot();e=$("#"+t.sel).click();if(e.length===0)return this.activateRoot()},events:{"#details view:render":function(){if(window.MathJax)return MathJax.Hub.Queue(["Typeset",MathJax.Hub])},"#show_description a click":function(){return $("#show_description").hide().next().slideDown()},"#branches a.js-new-branch:not(.is-disabled) click":function(e){return $("article a.js-new-branch").click()},"a.js-approve:not(.is-disabled) click":function(e,t){return t.preventDefault(),App.confirmModal.show({titleHtml:"Are you sure you want to approve this translation?",messageHtml:"This cannot be undone, you will be merging this version directly into the code challenge. Are you sure?",cancelHtml:"Nevermind",confirmHtml:"I'm sure",confirm:function(t){return function(){return t.track("Approved"),App.Api.post(e.attr("href"),{event:"approve"},function(e){return e.success?App.load(e.redirectUrl):App.alerts.fail(e.message||e.reason)})}}(this)})},"a.js-reject:not(.is-disabled) click":function(e,t){return t.preventDefault(),App.confirmModal.show({titleHtml:"Are you sure you want to reject this translation?",messageHtml:"This cannot be easily undone, you will be marking this translation as rejected and removing it from this list. Are you sure?",cancelHtml:"Nevermind",confirmHtml:"I'm sure",confirm:function(t){return function(){return t.track("Rejected"),App.Api.post(e.attr("href"),{event:"reject"},function(e){return e.success?App.load(e.redirectUrl):App.alerts.fail(e.message||e.reason)})}}(this)})},".tree-container .title-container:not(.is-active) click":function(e){return App.replaceUrlParams(function(t){return t.sel=e.attr("id"),t}),$(".tree-container .title-container.is-active").removeClass("is-active"),e.addClass("is-active"),this.viewData=e.data("view-data"),this.viewData&&($("#details, #tabs, #diff, #code_blocks").renderView(this.viewData),$("#comments view").renderView(this.viewData.discourse),$(".js-new-branch").toggleClass("is-disabled",this.viewData.state==="draft")),$("#tabs dd.is-active").length===0&&$("#tabs dd:first a").click(),this.track("Loaded",{record_id:this.viewData.id,action:this.viewData.action,language:this.viewData.language,title:this.viewData.title})},"#tabs dd a click":function(e){return App.data.activeTab=e.data("tab"),$("#comments > h4").toggle(App.data.activeTab!=="comments")}},activateRoot:function(){return $("#snippet_list .title-container:first").click()},track:function(e,t){return t==null&&(t={}),App.track("Kumite-Show: "+e,t)}}))}.call(this),function(){App.ns("Controls.CodeSnippets.TranslationsController",App.Control({init:function(e,t){return new App.Controls.CodeSnippetListItemController(this.element)}}))}.call(this),function(){App.ns("Views.CodeSnippets.ShowTabsView",App.View({filters:{active_tab:function(e){return App.data.activeTab===e.args.first()?"is-active":""},"can_close?":function(e){return!!e.context.canClose}}}))}.call(this);